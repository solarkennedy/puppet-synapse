description "synapse"

respawn
respawn limit 10 5

script
  set -e

  # When we no longer need to maintain compatibility with OSes != Ubuntu
  # Trusty, we can remove this, as Trusty provides logging and log
  # rotation for free.
  exec >>"<%= @log_file %>"

  # Allow HAProxy to use lots of fds
  ulimit -n 65535

  <%= @extra_init_string %>

  # Create synapse working directory if necessary
  mkdir -p "<%= @working_dir %>"
  chown -R <%= @user %> "<%= @working_dir %>"

  exec setuidgid <%= @user %> synapse --config <%= @config_file %> 2>&1
end script
